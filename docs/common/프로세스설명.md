# 준비스튜디오 전체 프로세스 설명

## 개요

준비스튜디오는 "참고사이트만 주세요, 나머지는 저희가 다 합니다"라는 슬로건으로 기획 능력이 부족한 소상공인/스타트업을 위한 웹개발 외주 서비스입니다. AI 자동화로 분석부터 화면설계까지 30분 내 완료하는 것이 핵심 강점입니다.

## 전체 프로세스 다이어그램

```
회원가입 → 상담신청 → AI분석 → 견적확인 → 계약금결제 → 프로젝트진행 → 산출물검토 → 잔금결제 → 완료
   ↓         ↓         ↓        ↓         ↓           ↓            ↓          ↓        ↓
  User   Consultation Payment Project   Payment    Document    Feedback   Payment Portfolio
```

## 1단계: 회원가입 및 로그인

### 사용자 플로우
1. 홈페이지 접속 (https://joonbi.co.kr)
2. 회원가입 버튼 클릭
3. 이메일/비밀번호/이름/전화번호 입력
4. 이메일 인증 (선택)
5. 로그인

### 기술 구현
- **인증 방식**: JWT (Access Token 1시간 + Refresh Token 7일)
- **비밀번호**: bcrypt 해싱 (saltRounds: 12)
- **역할**: CUSTOMER (기본) / ADMIN

### 관련 테이블
- `User`: 사용자 정보 저장

## 2단계: 상담 신청

### 2-1. 간편 상담 (SIMPLE)

무료 상담으로 기본적인 프로젝트 정보만 수집합니다.

#### 입력 정보
- 프로젝트명
- 간단한 설명
- 참고 URL (필수)
- 예산 범위 (선택)
- 희망 날짜 (선택)

#### 프로세스
1. 상담 정보 입력
2. 즉시 접수 (`ConsultationStatus.PENDING`)
3. 관리자가 수동으로 검토
4. 견적 및 분석 결과 제공

### 2-2. 분석 상담 (ANALYSIS)

유료 상담(30,000원)으로 AI가 자동으로 상세 분석을 수행합니다.

#### 입력 정보
간편 상담 정보 + 추가:
- 상세 요구사항
- 기능 목록
- 참고 자료 (파일 업로드)

#### AI 자동 분석 프로세스
1. 상담 신청 완료
2. 결제 완료 (`PaymentType.CONSULTATION`)
3. **Discord 웹훅 트리거** → Clawdbot 호출
4. AI 분석 시작 (`AnalysisStatus.PROCESSING`)
   - 참고 URL 크롤링 및 분석
   - 기능 분해 및 복잡도 계산
   - 기술 스택 추천
   - 개발 기간 및 비용 산정
   - 위험 요소 식별
5. **Stitch MCP** → 화면설계 자동 생성 (Figma)
6. 분석 결과 저장 (`AnalysisStatus.DONE`)
   - 실현 가능성 (`Feasibility.FEASIBLE/CONDITIONAL/INFEASIBLE`)
   - 견적 범위 (최소~최대)
   - 예상 개발 기간
   - 기능 목록 (JSON)
   - 위험 요소 배열
7. 자동 문서 생성 (`ConsultationFile`)
   - 분석서 (analysis)
   - 요구사항명세서 (requirements)
   - 프로젝트계획서 (plan)
   - 견적서 (quotation)

#### 특이사항
- 분석 실패 시 (`AnalysisStatus.FAILED`) 자동 환불
- 개발 불가 판정 시 (`Feasibility.INFEASIBLE`) 자동 환불 + 거절 사유 제공

### 관련 테이블
- `Consultation`: 상담 정보 및 AI 분석 결과
- `ConsultationFile`: 자동 생성된 문서
- `ConsultationDesign`: Stitch로 생성된 화면설계
- `Payment`: 분석 상담 결제
- `EventSlot`: 무료 상담 이벤트 슬롯 관리

## 3단계: 견적 확인 및 프로젝트 전환

### 고객 확인 사항
1. AI 분석 결과 검토
   - 자동 생성된 분석서
   - 요구사항명세서
   - 견적서
   - 화면설계 (Figma)
2. 견적 수락/거절 선택

### 프로젝트 전환 프로세스
1. 고객이 견적 수락
2. 관리자가 프로젝트 생성
   - `ProjectCode`: PROJ-001, PROJ-002... (자동 증가)
   - 총 견적액 설정
   - **계약금 30% + 잔금 70%** 자동 계산
   - **포트폴리오 동의 시 10% 할인** 적용
3. 상담 상태 변경: `ConsultationStatus.CONVERTED`
4. 프로젝트 상태: `ProjectStatus.CONTRACT` (계약 대기)

### 관련 테이블
- `Project`: 프로젝트 생성
- `Consultation`: 상태 업데이트

## 4단계: 계약금 결제

### 결제 프로세스
1. 프로젝트 생성 알림 수신 (`NotificationType.PAYMENT_REQUEST`)
2. 마이페이지에서 계약금 결제 페이지 진입
3. **NICE 결제 모듈** 연동
   - `NICE_CLIENT_ID` / `NICE_CLIENT_SECRET`
   - Callback URL: `https://joonbi.co.kr/api/payments/callback`
   - Cancel URL: `https://joonbi.co.kr/my/payments/cancel`
4. 결제 완료 (`PaymentType.CONTRACT`, `PaymentStatus.COMPLETED`)
5. 프로젝트 상태 변경: `ProjectStatus.IN_PROGRESS`
6. 시작일 설정 (`startDate`)

### 관련 테이블
- `Payment`: 계약금 결제 내역
- `Project`: 상태 및 시작일 업데이트
- `Notification`: 결제 요청 알림

## 5단계: 프로젝트 진행

### 산출물 생성
프로젝트 생성 시 자동으로 필수 산출물 생성:

#### 필수 산출물
1. **요구사항명세서** (`DocumentType.REQUIREMENTS`)
   - 가중치: 10%
   - 피드백 한도: 5회
2. **소스코드** (`DocumentType.SOURCE_CODE`)
   - 가중치: 60%
   - 피드백 한도: 5회
3. **운영매뉴얼** (`DocumentType.MANUAL`)
   - 가중치: 15%
   - 피드백 한도: 5회
4. **관리자계정정보** (`DocumentType.CREDENTIALS`)
   - 가중치: 5%
   - 피드백 한도: 0회 (변경 불가)

#### 선택 산출물
5. 화면설계서 (`DocumentType.SCREEN_DESIGN`) - 10%
6. ERD (`DocumentType.ERD`) - 5%
7. API명세서 (`DocumentType.API_SPEC`) - 5%
8. 시스템아키텍처 (`DocumentType.ARCHITECTURE`) - 5%
9. 테스트결과서 (`DocumentType.TEST_RESULT`) - 5%

### 산출물 상태 흐름

```
WAITING → WORKING → REVIEW → FEEDBACK ↔ APPROVED → DELIVERED
  대기     작업중     검토중    피드백      승인      납품완료
```

### 관리자 작업
1. 산출물 작업 시작 (`DocumentStatus.WORKING`)
2. 작업 완료 후 파일 업로드
3. 고객에게 검토 요청 (`DocumentStatus.REVIEW`)
4. 검토 마감일 설정 (`reviewDeadline`)
5. 알림 발송 (`NotificationType.REVIEW_REQUEST`)

### 고객 검토
1. 산출물 다운로드 및 검토
2. 승인 또는 피드백 작성

### 관련 테이블
- `Document`: 산출물 정보 및 상태
- `Notification`: 검토 요청 알림

## 6단계: 피드백 관리

### 피드백 제출
1. 고객이 산출물에 대한 피드백 작성
2. 피드백 유형 선택:
   - `FeedbackType.BUG`: 버그 (무료 수정)
   - `FeedbackType.CHANGE`: 수정 요청 (무료, 한도 내)
   - `FeedbackType.QUESTION`: 질문 (무료)
   - `FeedbackType.NEW_FEATURE`: 신규 기능 (유료)
3. 신규 기능일 경우 추가 비용 산정 필요

### 피드백 한도 관리
- 각 산출물당 5회 피드백 가능
- 한도 초과 시 추가 피드백은 유료 (`extraCost`)
- `feedbackItemCount` 자동 증가

### 피드백 상태 흐름

```
PENDING → IN_PROGRESS → RESOLVED
  대기       처리중        해결
                    ↘ REJECTED
                        거절
```

### 관리자 처리
1. 피드백 확인 (`FeedbackStatus.PENDING`)
2. 처리 시작 (`FeedbackStatus.IN_PROGRESS`)
3. 수정 완료 후 응답 작성
4. 피드백 해결 (`FeedbackStatus.RESOLVED`)
5. 고객에게 알림 (`NotificationType.FEEDBACK_REPLIED`)

### 산출물 승인
- 모든 피드백 해결 시 고객이 승인
- 산출물 상태: `DocumentStatus.APPROVED`

### 관련 테이블
- `DocumentFeedback`: 피드백 내역
- `Document`: 피드백 카운트 업데이트
- `Notification`: 피드백 답변 알림

## 7단계: 메시지 소통

### 실시간 메시지 시스템
프로젝트 진행 중 고객과 관리자 간 실시간 소통

#### 기능
1. 프로젝트별 메시지 스레드
2. 읽음/안읽음 표시
3. 미읽은 메시지 카운트
4. 메시지 수신 시 알림 (`NotificationType.MESSAGE_RECEIVED`)

#### 권한
- **고객**: 자신의 프로젝트 메시지만 조회/작성
- **관리자**: 모든 프로젝트 메시지 조회/작성

#### 자동 읽음 처리
- 메시지 조회 시 자동으로 `isRead = true` 업데이트

### 관련 테이블
- `Message`: 메시지 내역
- `Notification`: 메시지 수신 알림

## 8단계: 산출물 납품 및 잔금 결제

### 납품 조건
1. **모든 필수 산출물** `DocumentStatus.APPROVED` 상태
2. 관리자가 최종 검수 완료
3. 프로젝트 상태 변경: `ProjectStatus.REVIEW`

### 최종 검수
1. 관리자가 전체 산출물 검수
2. 고객에게 최종 확인 요청
3. 고객 최종 승인

### 잔금 결제
1. 잔금 결제 요청 알림 (`NotificationType.PAYMENT_REQUEST`)
2. NICE 결제 모듈 연동
3. 결제 완료 (`PaymentType.FINAL`, `PaymentStatus.COMPLETED`)
4. 모든 산출물 상태: `DocumentStatus.DELIVERED`
5. 프로젝트 상태: `ProjectStatus.COMPLETED`
6. 실제 종료일 설정 (`actualEndDate`)

### 관련 테이블
- `Payment`: 잔금 결제 내역
- `Document`: 납품 완료 상태
- `Project`: 완료 상태 및 종료일
- `Notification`: 잔금 결제 요청 알림

## 9단계: 프로젝트 완료 및 포트폴리오

### 프로젝트 완료
1. 프로젝트 완료 알림 (`NotificationType.PROJECT_COMPLETED`)
2. 고객 만족도 조사 (선택)
3. 프로젝트 아카이빙

### 포트폴리오 등록
계약 시 포트폴리오 동의한 경우:

#### 포트폴리오 생성
1. 관리자가 포트폴리오 작성
2. 공개 유형 선택:
   - `PortfolioDisplay.FULL`: 전체 공개 (고객명 포함)
   - `PortfolioDisplay.ANONYMOUS`: 익명 공개 (고객명 제외)
   - `PortfolioDisplay.PRIVATE`: 비공개 (내부 자료용)
3. 프로젝트 스크린샷 업로드 (`PortfolioImage`)
4. SEO 친화적 슬러그 생성 (`slug`)

#### 포트폴리오 공개
- `isPublic = true` 설정 시 공식 웹사이트에 노출
- 잠재 고객에게 실제 사례 제공

### 관련 테이블
- `Portfolio`: 포트폴리오 정보
- `PortfolioImage`: 포트폴리오 이미지

## 10단계: 추가 비용 처리

### 추가 비용 발생 사유
1. 피드백 한도 초과
2. 신규 기능 요청 (`FeedbackType.NEW_FEATURE`)
3. 계약 외 추가 작업

### 추가 결제 프로세스
1. 관리자가 추가 비용 산정
2. 고객에게 견적 제공
3. 고객 승인
4. 추가 결제 (`PaymentType.EXTRA`)
5. 작업 진행

### 관련 테이블
- `DocumentFeedback`: 추가 비용 정보 (`extraCost`)
- `Payment`: 추가 결제 내역

## 알림 시스템

### 알림 유형

| 알림 타입 | 발생 시점 | 대상 |
|----------|----------|------|
| `CONSULTATION_RESULT` | AI 분석 완료 | 고객 |
| `PAYMENT_REQUEST` | 계약금/잔금 결제 요청 | 고객 |
| `DOCUMENT_UPLOADED` | 산출물 업로드 | 고객 |
| `REVIEW_REQUEST` | 검토 요청 | 고객 |
| `REVIEW_DEADLINE` | 검토 마감 24시간 전 | 고객 |
| `FEEDBACK_REPLIED` | 피드백 답변 완료 | 고객 |
| `PROJECT_COMPLETED` | 프로젝트 완료 | 고객 |
| `MESSAGE_RECEIVED` | 메시지 수신 | 고객/관리자 |

### 알림 전송 채널
1. 웹 알림 (인앱)
2. 이메일 (Resend API)
3. 카카오톡 알림톡 (선택)

### 관련 테이블
- `Notification`: 알림 내역

## 관리자 전용 기능

### 대시보드
- 진행 중인 프로젝트 현황
- 대기 중인 상담 목록
- 미처리 피드백 현황
- 수익 통계

### 상담 관리
- AI 분석 결과 검토 및 수정
- 수동 견적 작성
- 상담 승인/거절

### 프로젝트 관리
- 프로젝트 생성
- 산출물 업로드
- 진행률 관리
- 일정 관리

### 메시지 관리
- 모든 프로젝트 메시지 조회
- 고객 문의 응대

### 통계 및 보고서
- 월별 매출 리포트
- 프로젝트 완료율
- 고객 만족도

## 보안 및 권한 관리

### 인증 (Authentication)
- JWT 기반 인증
- Access Token (1시간) + Refresh Token (7일)
- 비밀번호 bcrypt 해싱

### 인가 (Authorization)
- Role-based Access Control (RBAC)
- `@Roles()` 데코레이터로 권한 체크
- 리소스 소유권 검증 (고객은 자신의 데이터만 접근)

### 데이터 보호
- 민감 정보 환경변수 관리
- SQL Injection 방지 (Prisma 자동 방지)
- XSS 방지 (입력 검증 + 출력 이스케이프)

## 기술 아키텍처

### Frontend (Vercel)
- **URL**: https://joonbi.co.kr
- **기술**: Next.js 16 (App Router), Tailwind CSS
- **배포**: Vercel 자동 배포

### Backend (Docker + CloudFlare Tunnel)
- **Public URL**: https://api.joonbi.co.kr
- **Local Port**: localhost:8081
- **기술**: NestJS 10, Prisma, PostgreSQL 15
- **배포**: Docker Compose + CloudFlare Tunnel

### Database
- **엔진**: PostgreSQL 15
- **ORM**: Prisma
- **포트**: localhost:5435

### 외부 API
- **결제**: NICE 결제 모듈
- **이메일**: Resend API
- **알림톡**: 카카오 알림톡 API
- **AI 분석**: Discord Webhook → Clawdbot
- **화면설계**: Stitch MCP

## 데이터 흐름 요약

```
1. User 회원가입
   ↓
2. Consultation 신청 → AI 분석 → ConsultationFile 생성
   ↓                              ↓
3. Payment (상담비)          ConsultationDesign (화면설계)
   ↓
4. Project 생성 ← Consultation 전환
   ↓
5. Payment (계약금)
   ↓
6. Document 생성 (필수 + 선택)
   ↓
7. Message 소통
   ↓
8. DocumentFeedback 처리
   ↓
9. Document 승인
   ↓
10. Payment (잔금)
    ↓
11. Project 완료 → Portfolio 등록
```

## 핵심 비즈니스 로직

### 1. AI 자동화 파이프라인
- Discord 웹훅 → Clawdbot 트리거
- 30분 내 분석 완료
- 자동 문서 생성 (분석서, 명세서, 견적서)
- Stitch MCP 화면설계 자동 생성

### 2. 2단계 결제 시스템
- 계약금 30% (프로젝트 시작 전)
- 잔금 70% (납품 완료 후)
- 포트폴리오 동의 시 10% 할인

### 3. 피드백 한도 관리
- 산출물당 5회 무료 피드백
- 초과 시 유료 처리
- 신규 기능 요청은 별도 견적

### 4. 진행률 추적
- 산출물별 가중치 기반 진행률 계산
- 실시간 프로젝트 현황 업데이트

## 확장 가능성

### Phase 2 (향후 계획)
- 실시간 채팅 (Socket.io)
- 화상 회의 연동
- 프로젝트 템플릿 마켓플레이스
- 개발자 매칭 시스템

### Phase 3
- 모바일 앱 (React Native)
- 자동 배포 파이프라인
- AI 코드 리뷰
- 유지보수 계약 관리
