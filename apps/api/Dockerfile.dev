FROM node:20-alpine

WORKDIR /app

# 기본 도구 설치 (필요시)
RUN apk add --no-cache libc6-compat

# 루트 설정 및 의존성 복사
COPY package.json package-lock.json* ./
COPY apps/api/package.json ./apps/api/
COPY packages/shared/package.json ./packages/shared/

# 의존성 설치
RUN npm install

# 소스 코드 복사
COPY . .

# Prisma 클라이언트 생성
RUN npx prisma generate --schema=./apps/api/prisma/schema.prisma

WORKDIR /app/apps/api

EXPOSE 4000

# 개발 서버 시작
CMD ["npm", "run", "start:dev"]